define([M.cfg.wwwroot+"/local/learnwise/vendorjs/zenorocha/clipboard.min.js","core/str","core/notification","core/fragment","core/config","core/templates"],function(a,b,c,d,e,f){function g(){t.floatingButtonAssistantId.addEventListener("input",function(a){s.floatingButtonAssistantId=a.target.value,j()}),t.ltiAssistantId&&t.ltiAssistantId.addEventListener("input",function(a){s.ltiAssistantId=a.target.value,l()}),t.floatingButtonSwitch.addEventListener("click",function(){h()&&(s.showFloatingButton=!s.showFloatingButton,j())}),t.webServicesSwitch.addEventListener("click",function(){s.webServicesEnabled=!s.webServicesEnabled,o()}),t.liveApiSwitch.addEventListener("click",function(){s.liveApiEnabled=!s.liveApiEnabled,p()}),t.aiAssessmentSwitch.addEventListener("click",function(){s.aiAssessmentEnabled=!s.aiAssessmentEnabled,m()}),t.courseIds.addEventListener("input",function(a){s.courseIds=a.target.value,n()}),t.ltiRemovalModal.addEventListener("click",function(a){a.target===t.closeLtiModal&&q(),a.target===t.confirmLtiRemoval&&r(),a.target===t.ltiRemovalModal&&q()});var d=document.querySelectorAll('input[name="environment"]');d.forEach(function(a){a.checked&&(s.environment=a.value),a.addEventListener("change",function(a){a.target.checked&&(s.environment=a.target.value,k())})}),t.ltiSwitch&&t.ltiSwitch.addEventListener("click",function(){i()&&(s.ltiEnabled?t.ltiRemovalModal.style.display="flex":(s.ltiEnabled=!0,l()))});var e=new a(".copy-btn");e.on("success",function(a){a.clearSelection(),b.get_string("copied","local_learnwise").then(function(a){return s.showToast?require(["core/toast"],function(b){b.add(a)}):alert(a),null})["catch"](c.exception)})}function h(){return s.floatingButtonAssistantId.trim().length>0}function i(){return s.ltiAssistantId.trim().length>0}function j(){var a=h();a?(t.floatingButtonSwitch.classList.remove("disabled"),t.floatingButtonSwitchWrapper.style.cursor="pointer",t.floatingButtonTooltip.style.display="none",s.showFloatingButton?(t.floatingButtonSwitch.classList.add("active"),b.get_string("statusenabled","local_learnwise").then(function(a){return t.floatingButtonStatus.textContent=a,null}).fail(c.exception)):(t.floatingButtonSwitch.classList.remove("active"),b.get_string("statusdisabled","local_learnwise").then(function(a){return t.floatingButtonStatus.textContent=a,null}).fail(c.exception))):(t.floatingButtonSwitch.classList.remove("active"),t.floatingButtonSwitch.classList.add("disabled"),t.floatingButtonSwitchWrapper.style.cursor="not-allowed",b.get_string("statusdisabled","local_learnwise").then(function(a){return t.floatingButtonStatus.textContent=a,null}).fail(c.exception),s.showFloatingButton=!1),t.form.elements.floatingButtonStatus.value=s.showFloatingButton?1:0}function k(){t.ltiConfig&&i()&&s.ltiEnabled&&d.loadFragment("local_learnwise","process_setup",e.contextid,{formdata:"enablelti="+(s.ltiEnabled?1:0)+"&assistantid="+encodeURIComponent(t.ltiAssistantId.value)+"&environment="+encodeURIComponent(s.environment)}).then(function(a,b){return f.replaceNodeContents(t.ltiConfig,a,b),null})["catch"](c.exception)}function l(){if(t.ltiAssistantId){var a=i();a?(t.ltiSwitch.classList.remove("disabled"),t.ltiSwitchWrapper.style.cursor="pointer",t.ltiTooltip.style.display="none",s.ltiEnabled?(t.ltiSwitch.classList.add("active"),b.get_string("statusenabled","local_learnwise").then(function(a){return t.ltiStatus.textContent=a,null})["catch"](c.exception),t.ltiConfig.style.display="block"):(t.ltiSwitch.classList.remove("active"),b.get_string("statusdisabled","local_learnwise").then(function(a){return t.ltiStatus.textContent=a,null})["catch"](c.exception),t.ltiConfig.style.display="none"),k()):(t.ltiSwitch.classList.remove("active"),t.ltiSwitch.classList.add("disabled"),t.ltiSwitchWrapper.style.cursor="not-allowed",b.get_string("statusdisabled","local_learnwise").then(function(a){return t.ltiStatus.textContent=a,null})["catch"](c.exception),t.ltiConfig.style.display="none",s.ltiEnabled=!1),t.form.elements.ltiStatus.value=s.ltiEnabled?1:0}}function m(){s.aiAssessmentEnabled?(t.aiAssessmentSwitch.classList.add("active"),b.get_string("statusenabled","local_learnwise").then(function(a){return t.aiAssessmentStatus.textContent=a,null})["catch"](c.exception)):(t.aiAssessmentSwitch.classList.remove("active"),b.get_string("statusdisabled","local_learnwise").then(function(a){return t.aiAssessmentStatus.textContent=a,null})["catch"](c.exception)),t.form.elements.aiAssessmentStatus.value=s.aiAssessmentEnabled?1:0}function n(){var a=/^(\d+)(,\d+)*$/,b=document.getElementById("save-btn"),c=t.courseIds,d=(s.courseIds||"").trim();if(!d)return c.classList.remove("border-danger"),b.disabled=!1,void(b.className="save-btn");var e=a.test(s.courseIds);c.classList.toggle("border-danger",!e),b.disabled=!e,b.className=e?"save-btn":"save-btn bg-gray text-dark"}function o(){s.webServicesEnabled?(t.webServicesSwitch.classList.add("active"),b.get_string("statusenabled","local_learnwise").then(function(a){return t.webServicesStatus.textContent=a,null})["catch"](c.exception),t.webServicesConfig.style.display="block"):(t.webServicesSwitch.classList.remove("active"),b.get_string("statusdisabled","local_learnwise").then(function(a){return t.webServicesStatus.textContent=a,null})["catch"](c.exception),t.webServicesConfig.style.display="none"),d.loadFragment("local_learnwise","process_setup",e.contextid,{formdata:"enablewebservice="+(s.webServicesEnabled?1:0)}).then(function(a,b){return f.replaceNodeContents(t.webServicesConfig,a,b),null})["catch"](c.exception),t.form.elements.webServicesStatus.value=s.webServicesEnabled?1:0}function p(){s.liveApiEnabled?(t.liveApiSwitch.classList.add("active"),b.get_string("statusenabled","local_learnwise").then(function(a){return t.liveApiStatus.textContent=a,null})["catch"](c.exception),t.liveApiConfig.style.display="block"):(t.liveApiSwitch.classList.remove("active"),b.get_string("statusdisabled","local_learnwise").then(function(a){return t.liveApiStatus.textContent=a,null})["catch"](c.exception),t.liveApiConfig.style.display="none"),t.form.elements.liveApiStatus.value=s.liveApiEnabled?1:0}function q(){t.ltiRemovalModal.style.display="none"}function r(){s.ltiEnabled=!1,l(),q()}var s={environment:"sandbox",floatingButtonAssistantId:"",showFloatingButton:!1,ltiAssistantId:"",ltiEnabled:!1,webServicesEnabled:!1,liveApiEnabled:!1,aiAssessmentEnabled:!1,courseIds:""},t={form:document.getElementById("form1"),floatingButtonAssistantId:document.getElementById("floatingButtonAssistantId"),floatingButtonSwitch:document.getElementById("floatingButtonSwitch"),floatingButtonStatus:document.getElementById("floatingButtonStatus"),floatingButtonSwitchWrapper:document.getElementById("floatingButtonSwitchWrapper"),floatingButtonTooltip:document.getElementById("floatingButtonTooltip"),ltiAssistantId:document.getElementById("ltiAssistantId"),ltiSwitch:document.getElementById("ltiSwitch"),ltiStatus:document.getElementById("ltiStatus"),ltiSwitchWrapper:document.getElementById("ltiSwitchWrapper"),ltiTooltip:document.getElementById("ltiTooltip"),ltiConfig:document.getElementById("ltiConfig"),webServicesSwitch:document.getElementById("webServicesSwitch"),webServicesStatus:document.getElementById("webServicesStatus"),webServicesConfig:document.getElementById("webServicesConfig"),liveApiSwitch:document.getElementById("liveApiSwitch"),liveApiStatus:document.getElementById("liveApiStatus"),liveApiConfig:document.getElementById("liveApiConfig"),ltiRemovalModal:document.getElementById("ltiRemovalModal"),closeLtiModal:document.getElementById("closeLtiModal"),confirmLtiRemoval:document.getElementById("confirmLtiRemoval"),aiAssessmentSwitch:document.getElementById("aiAssessmentSwitch"),aiAssessmentStatus:document.getElementById("aiAssessmentStatus"),courseIds:document.getElementById("courseIds")};return t.floatingButtonAssistantId&&(s.floatingButtonAssistantId=t.floatingButtonAssistantId.value),t.ltiAssistantId&&(s.ltiAssistantId=t.ltiAssistantId.value),t.floatingButtonStatus&&(s.showFloatingButton=1===parseInt(t.form.elements.floatingButtonStatus.value)),t.ltiStatus&&(s.ltiEnabled=1===parseInt(t.form.elements.ltiStatus.value)),t.webServicesStatus&&(s.webServicesEnabled=1===parseInt(t.form.elements.webServicesStatus.value)),t.liveApiStatus&&(s.liveApiEnabled=1===parseInt(t.form.elements.liveApiStatus.value)),t.aiAssessmentStatus&&(s.aiAssessmentEnabled=1===parseInt(t.form.elements.aiAssessmentStatus.value)),t.courseIds&&(s.courseIds=t.courseIds.value),{init:function(a){s.showToast=a,g(),j(),l(),o(),p(),m()}}});